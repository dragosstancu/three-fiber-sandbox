/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import React, { useRef, useEffect, useState } from "react";
import { useGLTF } from "@react-three/drei";
// import * as THREE from 'three'

import { useFrame } from '@react-three/fiber';
// import { useSpring } from '@react-spring/core';

import { proxy } from "valtio";//, useSnapshot

// const vec = new THREE.Vector3();
// const defaultCursor = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0yNCwxLjUgQzMwLjIxMzIwMzQsMS41IDM1LjgzODIwMzQsNC4wMTgzOTgyOCAzOS45MDk5MDI2LDguMDkwMDk3NDIgQzQzLjk4MTYwMTcsMTIuMTYxNzk2NiA0Ni41LDE3Ljc4Njc5NjYgNDYuNSwyNCBDNDYuNSwzMC4yMTMyMDM0IDQzLjk4MTYwMTcsMzUuODM4MjAzNCAzOS45MDk5MDI2LDM5LjkwOTkwMjYgQzM1LjgzODIwMzQsNDMuOTgxNjAxNyAzMC4yMTMyMDM0LDQ2LjUgMjQsNDYuNSBDMTcuNzg2Nzk2Niw0Ni41IDEyLjE2MTc5NjYsNDMuOTgxNjAxNyA4LjA5MDA5NzQyLDM5LjkwOTkwMjYgQzQuMDE4Mzk4MjgsMzUuODM4MjAzNCAxLjUsMzAuMjEzMjAzNCAxLjUsMjQgTDEuNSwyNCBMMS41LDEuNSBaIiBzdHJva2U9IiM4RDhEOEQiIHN0cm9rZS13aWR0aD0iMyIgZmlsbC1vcGFjaXR5PSIuNyIgZmlsbD0iI0ZGRiIvPjxjaXJjbGUgZmlsbC1vcGFjaXR5PSIuNyIgZmlsbD0iIzY0NjQ2NCIgY3g9IjgiIGN5PSI4IiByPSIyIi8+PC9nPjwvc3ZnPg==';
// const hoveredCursor = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0yNCwyIEMzMC4wNzUxMzIyLDIgMzUuNTc1MTMyMiw0LjQ2MjQzMzg4IDM5LjU1NjM0OTIsOC40NDM2NTA4MSBDNDMuNTM3NTY2MSwxMi40MjQ4Njc4IDQ2LDE3LjkyNDg2NzggNDYsMjQgQzQ2LDMwLjA3NTEzMjIgNDMuNTM3NTY2MSwzNS41NzUxMzIyIDM5LjU1NjM0OTIsMzkuNTU2MzQ5MiBDMzUuNTc1MTMyMiw0My41Mzc1NjYxIDMwLjA3NTEzMjIsNDYgMjQsNDYgQzE3LjkyNDg2NzgsNDYgMTIuNDI0ODY3OCw0My41Mzc1NjYxIDguNDQzNjUwODEsMzkuNTU2MzQ5MiBDNC40NjI0MzM4OCwzNS41NzUxMzIyIDIsMzAuMDc1MTMyMiAyLDI0IEwyLDI0IEwyLDIgWiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9IjQiIGZpbGwtb3BhY2l0eT0iLjI5OCIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik0yMC4wMDA1MDQ2LDI3Ljc3MjQ1MTggTDE5LjY4NDc3ODUsMjcuNzMzNTc4MSBMMTkuMDY2MTgyLDI3LjY0NzM0OSBDMTQuODk5NjEzNSwyNy4wMjAxMjYgMTIsMjUuNjIyOTM2NSAxMiwyNCBDMTIsMjIuODk1NDMwNSAxMy4zNDMxNDU4LDIxLjg5NTQzMDUgMTUuNTE0NzE4NiwyMS4xNzE1NzI5IEwxNS45OTI1NDgxLDIxLjAyMDc0OTcgQzE2LjE1NTkyNjIsMjAuOTcxOTI1OSAxNi4zMjMzNDM0LDIwLjkyNDU3MzUgMTYuNDk0NjEyMSwyMC44Nzg3NTUxIEwxNy4wMTk3ODUyLDIwLjc0NTk2NDEgTDE3LjU2Njk0MTgsMjAuNjIyNzUxOSBDMTcuOTM4NzkwNywyMC41NDM4ODY3IDE4LjMyNDU0NDksMjAuNDcxNjU3NiAxOC43MjI3MDM5LDIwLjQwNjU2NDYgTDE5LjMyOTA1ODUsMjAuMzE0MzM5OCBDMTkuNDMxNjA1NiwyMC4yOTk4ODE5IDE5LjUzNDg4MTIsMjAuMjg1ODg1NiAxOS42Mzg4NjE3LDIwLjI3MjM1ODggTDIwLjI3MTAxNjYsMjAuMTk2ODkzOSBDMjAuMzc3NzIzMiwyMC4xODUyNzYxIDIwLjQ4NTA4NzgsMjAuMTc0MTQzNSAyMC41OTMwODcsMjAuMTYzNTAzOCBMMjEuMjQ4NTEwMSwyMC4xMDU2NDI5IEwyMS45MTgwMzg0LDIwLjA1OTk4NjggQzIyLjE0MzQ0MDMsMjAuMDQ2ODQ0IDIyLjM3MTAwNTYsMjAuMDM1Nzk3OSAyMi42MDA1NDY1LDIwLjAyNjkxMDkgTDIzLjI5NDkwODgsMjAuMDA2NzkwMyBDMjMuNDExNTYxMiwyMC4wMDQ1MzczIDIzLjUyODY2MDcsMjAuMDAyODM5NyAyMy42NDYxODM3LDIwLjAwMTcwNTQgTDI0LDIwIEMyNC4yMzY2OTM1LDIwIDI0LjQ3MTc4NjQsMjAuMDAyMjg0MyAyNC43MDUwOTEyLDIwLjAwNjc5MDMgTDI1LjM5OTQ1MzUsMjAuMDI2OTEwOSBDMjUuNjI4OTk0NCwyMC4wMzU3OTc5IDI1Ljg1NjU1OTcsMjAuMDQ2ODQ0IDI2LjA4MTk2MTYsMjAuMDU5OTg2OCBMMjYuNzUxNDg5OSwyMC4xMDU2NDI5IEwyNy40MDY5MTMsMjAuMTYzNTAzOCBDMjcuNTE0OTEyMiwyMC4xNzQxNDM1IDI3LjYyMjI3NjgsMjAuMTg1Mjc2MSAyNy43Mjg5ODM0LDIwLjE5Njg5MzkgTDI4LjM2MTEzODMsMjAuMjcyMzU4OCBDMjguNDY1MTE4OCwyMC4yODU4ODU2IDI4LjU2ODM5NDQsMjAuMjk5ODgxOSAyOC42NzA5NDE1LDIwLjMxNDMzOTggTDI5LjI3NzI5NjEsMjAuNDA2NTY0NiBDMjkuNjc1NDU1MSwyMC40NzE2NTc2IDMwLjA2MTIwOTMsMjAuNTQzODg2NyAzMC40MzMwNTgyLDIwLjYyMjc1MTkgTDMwLjk4MDIxNDgsMjAuNzQ1OTY0MSBMMzEuNTA1Mzg3OSwyMC44Nzg3NTUxIEMzMS42NzY2NTY2LDIwLjkyNDU3MzUgMzEuODQ0MDczOCwyMC45NzE5MjU5IDMyLjAwNzQ1MTksMjEuMDIwNzQ5NyBMMzIuNDg1MjgxNCwyMS4xNzE1NzI5IEMzNC42NTY4NTQyLDIxLjg5NTQzMDUgMzYsMjIuODk1NDMwNSAzNiwyNCBDMzYsMjUuNTA0MDc4MyAzMy41MDk1NDk1LDI2LjgxNDI2NDUgMjkuODI4MjI1NiwyNy40OTczNjY1IEwyOS4yMzcyNTY5LDI3LjU5OTk1MDMgQzI5LjEzNzE3NTksMjcuNjE2MTU4MSAyOS4wMzYzMTc1LDI3LjYzMTkxNTcgMjguOTM0NzA1NSwyNy42NDcyMTU0IEwyOC4zMTYxNzkxLDI3LjczMzQ1NSBDMjguMjExNjQ3MiwyNy43NDY4OTE0IDI4LjEwNjQwOSwyNy43NTk4NTM5IDI4LjAwMDQ4ODIsMjcuNzcyMzM0OSIgc3Ryb2tlPSIjRkZGIi8+PGNpcmNsZSBmaWxsPSIjRkZGIiBjeD0iMjQiIGN5PSIyOCIgcj0iMiIvPjxwYXRoIGQ9Ik0yNCwxIEMzMC4zNTEyNzQ2LDEgMzYuMTAxMjc0NiwzLjU3NDM2MjY5IDQwLjI2MzQ1Niw3LjczNjU0NDAzIEM0NC40MjU2MzczLDExLjg5ODcyNTQgNDcsMTcuNjQ4NzI1NCA0NywyNCBDNDcsMzAuMzUxMjc0NiA0NC40MjU2MzczLDM2LjEwMTI3NDYgNDAuMjYzNDU2LDQwLjI2MzQ1NiBDMzYuMTAxMjc0Niw0NC40MjU2MzczIDMwLjM1MTI3NDYsNDcgMjQsNDcgQzE3LjY0ODcyNTQsNDcgMTEuODk4NzI1NCw0NC40MjU2MzczIDcuNzM2NTQ0MDMsNDAuMjYzNDU2IEMzLjU3NDM2MjY5LDM2LjEwMTI3NDYgMSwzMC4zNTEyNzQ2IDEsMjQgTDEsMjQgTDEsMSBaIiBzdHJva2Utb3BhY2l0eT0iLjQ5NyIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiLz48L2c+PC9zdmc+';



const state = proxy({
    current: null,
    items: {
        front: "#336699",
        back: "#336699",
        filler: "#ffffff",
        blue: "#336699",
    },
});

export default function Model({ open, ...props }) {
    const bag = useRef();
    // const snap = useSnapshot(state);

    const { nodes, materials } = useGLTF("/models/glb/bag.gltf");
    const [hovered, set] = useState(false);//setHovered

    useEffect(() => {
        const defaultSVG = '<svg width="32" height="32" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M24,1.5 C30.2132034,1.5 35.8382034,4.01839828 39.9099026,8.09009742 C43.9816017,12.1617966 46.5,17.7867966 46.5,24 C46.5,30.2132034 43.9816017,35.8382034 39.9099026,39.9099026 C35.8382034,43.9816017 30.2132034,46.5 24,46.5 C17.7867966,46.5 12.1617966,43.9816017 8.09009742,39.9099026 C4.01839828,35.8382034 1.5,30.2132034 1.5,24 L1.5,24 L1.5,1.5 Z" stroke="#8D8D8D" stroke-width="3" fill-opacity=".7" fill="#FFF"/><circle fill-opacity=".7" fill="#666" cx="8" cy="8" r="2"/></g></svg>';
        const hoverSVG = '<svg width="32" height="32" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M24,2 C30.0751322,2 35.5751322,4.46243388 39.5563492,8.44365081 C43.5375661,12.4248678 46,17.9248678 46,24 C46,30.0751322 43.5375661,35.5751322 39.5563492,39.5563492 C35.5751322,43.5375661 30.0751322,46 24,46 C17.9248678,46 12.4248678,43.5375661 8.44365081,39.5563492 C4.46243388,35.5751322 2,30.0751322 2,24 L2,24 L2,2 Z" stroke="#FFF" stroke-width="4" fill-opacity=".298" fill="${snap.items[hovered]}"/><path d="M20.0005046,27.7724518 L19.6847785,27.7335781 L19.066182,27.647349 C14.8996135,27.020126 12,25.6229365 12,24 C12,22.8954305 13.3431458,21.8954305 15.5147186,21.1715729 L15.9925481,21.0207497 C16.1559262,20.9719259 16.3233434,20.9245735 16.4946121,20.8787551 L17.0197852,20.7459641 L17.5669418,20.6227519 C17.9387907,20.5438867 18.3245449,20.4716576 18.7227039,20.4065646 L19.3290585,20.3143398 C19.4316056,20.2998819 19.5348812,20.2858856 19.6388617,20.2723588 L20.2710166,20.1968939 C20.3777232,20.1852761 20.4850878,20.1741435 20.593087,20.1635038 L21.2485101,20.1056429 L21.9180384,20.0599868 C22.1434403,20.046844 22.3710056,20.0357979 22.6005465,20.0269109 L23.2949088,20.0067903 C23.4115612,20.0045373 23.5286607,20.0028397 23.6461837,20.0017054 L24,20 C24.2366935,20 24.4717864,20.0022843 24.7050912,20.0067903 L25.3994535,20.0269109 C25.6289944,20.0357979 25.8565597,20.046844 26.0819616,20.0599868 L26.7514899,20.1056429 L27.406913,20.1635038 C27.5149122,20.1741435 27.6222768,20.1852761 27.7289834,20.1968939 L28.3611383,20.2723588 C28.4651188,20.2858856 28.5683944,20.2998819 28.6709415,20.3143398 L29.2772961,20.4065646 C29.6754551,20.4716576 30.0612093,20.5438867 30.4330582,20.6227519 L30.9802148,20.7459641 L31.5053879,20.8787551 C31.6766566,20.9245735 31.8440738,20.9719259 32.0074519,21.0207497 L32.4852814,21.1715729 C34.6568542,21.8954305 36,22.8954305 36,24 C36,25.5040783 33.5095495,26.8142645 29.8282256,27.4973665 L29.2372569,27.5999503 C29.1371759,27.6161581 29.0363175,27.6319157 28.9347055,27.6472154 L28.3161791,27.733455 C28.2116472,27.7468914 28.106409,27.7598539 28.0004882,27.7723349" stroke="#FFF"/><circle fill="#FFF" cx="24" cy="28" r="2"/><path d="M24,1 C30.3512746,1 36.1012746,3.57436269 40.263456,7.73654403 C44.4256373,11.8987254 47,17.6487254 47,24 C47,30.3512746 44.4256373,36.1012746 40.263456,40.263456 C36.1012746,44.4256373 30.3512746,47 24,47 C17.6487254,47 11.8987254,44.4256373 7.73654403,40.263456 C3.57436269,36.1012746 1,30.3512746 1,24 L1,24 L1,1 Z" stroke-opacity=".497" stroke="#000" stroke-width="2"/></g></svg>';

        if (hovered) {
            // document.body.style.cursor = `url('${hoveredCursor}'), pointer`;
            // return () => (document.body.style.cursor = `url('${defaultCursor}'), auto`);
            document.body.style.cursor = `url('data:image/svg+xml;base64,${btoa(hoverSVG)}'), auto`;
            return () => (document.body.style.cursor = `url('data:image/svg+xml;base64,${btoa(defaultSVG)}'), auto`);
        }
    }, [hovered]);

    useFrame((state) => {
        const t = state.clock.getElapsedTime();
        bag.current.rotation.z = (Math.sin(t / 1.5)) / 20;
        // bag.current.rotation.x = Math.cos(t / 4) / 20;
        bag.current.rotation.y = Math.sin(t / 4) / 20;
        bag.current.position.y = (-.005 + Math.sin(t / 1.5)) / 50;
    });

    return (
        <group
            ref={bag}
            {...props}
            dispose={null}
            // onPointerOver={(e) => (setHovered(true), set(e.object.material.name))}
            // onPointerOut={() => setHovered(false)}
            onPointerOver={(e) => (e.stopPropagation(), set(e.object.material.name))}
            onPointerOut={(e) => e.intersections.length === 0 && set(null)}
            onClick={(e) => (e.stopPropagation(), (state.current = e.object.material.name))}
            position={[0, -.005, 0]}
            rotation={[0, 0, 0]}
            scale={[1.06, 0.77, 0.96]}
        >
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.ATR001_Doypack_0.geometry}
                material={materials.front}
            />
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.ATR001_Doypack_0_1.geometry}
                material={materials.back}
            />
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.ATR001_Doypack_0_2.geometry}
                material={materials.filler}
            />
        </group>
    );
}

useGLTF.preload("/models/glb/bag.gltf");